-- DevView 프로젝트 - 사용자 테이블 제약조건 수정 (V3)
-- 같은 이메일로 로컬가입과 구글가입을 별도로 허용하기 위한 스키마 변경

-- =============================================================================
-- 1. 기존 email UNIQUE 제약조건 제거
-- =============================================================================

-- 기존 email unique 제약조건 삭제
ALTER TABLE users DROP CONSTRAINT IF EXISTS users_email_key;

-- =============================================================================
-- 2. (email, provider) 복합 UNIQUE 제약조건 추가
-- =============================================================================

-- 같은 이메일이라도 provider가 다르면 별도 계정으로 관리
-- 예: test@gmail.com (LOCAL)과 test@gmail.com (GOOGLE)이 모두 가능
ALTER TABLE users ADD CONSTRAINT unique_email_provider UNIQUE (email, provider);

-- =============================================================================
-- 3. 기존 인덱스 최적화
-- =============================================================================

-- 새로운 복합 인덱스 추가 (email + provider 조합 검색 최적화)
CREATE INDEX idx_users_email_provider ON users(email, provider);